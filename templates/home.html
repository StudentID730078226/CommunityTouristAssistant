{% extends 'base.html' %}

{% block content %}

<header>
    <h2>Welcome to the Community Tourist Assistant</h2>
    <p>
        Discover local heritage sites, beaches, parks, nightlife, and more!
    </p>
</header>

<section class="mb-5 home-search" aria-labelledby="home-search-heading">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <h2 id="home-search-heading" class="h4 mb-2">Search for places</h2>
            <p class="text-muted mb-3">
                Find places by name, town, postcode, or keywords before you start browsing.
            </p>
            <form method="get" action="{% url 'places:search_places' %}" role="search">
                <label class="visually-hidden" for="home-search-q">Search places</label>
                <div class="input-group input-group-lg">
                    <input
                        id="home-search-q"
                        type="text"
                        name="q"
                        class="form-control"
                        placeholder="Try 'Fistral Beach' or 'Newquay'"
                        aria-describedby="home-search-help"
                        autocomplete="off"
                    >
                    <button class="btn btn-primary" type="submit">Search</button>
                </div>
                <div id="home-search-help" class="form-text">
                    You can refine results with filters on the search page.
                </div>
            </form>
        </div>
    </div>
</section>

<section class="mb-5" aria-labelledby="top-rated-heading">
    <h2 id="top-rated-heading" class="mb-3">Top-Rated Places</h2>

    {% if places %}
        <section class="mt-3">
            <div class="row g-3">
                {% for place in places %}
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 shadow-sm position-relative">
                            <div class="position-absolute top-0 end-0 m-2 d-flex align-items-center gap-1" aria-label="{{ place.likes_total }} likes">
                                <i class="bi bi-heart-fill text-danger" aria-hidden="true"></i>
                                <span class="small fw-semibold">{{ place.likes_total }}</span>
                                <span class="visually-hidden">likes</span>
                            </div>
                            <div class="card-body pe-5">
                                <h3 class="h5 mb-1">
                                    <a href="{% url 'places:place_detail' place.id %}">
                                        {{ place.name }}
                                    </a>
                                </h3>

                                <p class="text-muted mb-1">{{ place.get_category_display }}</p>

                                {% if place.avg_rating %}
                                    <p class="mb-0">&#9733; {{ place.avg_rating|floatformat:1 }}</p>
                                {% else %}
                                    <p class="mb-0 text-muted">No ratings yet</p>
                                {% endif %}
                            </div>

                            {% if place.images.all %}
                                <div class="place-card-images">
                                    {% for image in place.images.all|slice:":3" %}
                                        <img src="{{ image.image.url }}" alt="Photo of {{ place.name }}">
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        </section>
    {% else %}
        <p class="text-muted">No approved places yet.</p>
    {% endif %}
</section>

{% if user.is_authenticated %}
<section class="mb-5" aria-labelledby="liked-heading">
    <h2 id="liked-heading" class="mb-3">&#10084;&#65039; Places You've Liked</h2>

    {% if liked_places %}
        <section class="mt-3">
            <div class="row g-3">
                {% for place in liked_places %}
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body">
                                <h3 class="h5 mb-1">
                                    <a href="{% url 'places:place_detail' place.id %}">
                                        {{ place.name }}
                                    </a>
                                </h3>

                                <p class="text-muted mb-1">{{ place.get_category_display }}</p>

                                {% if place.average_rating %}
                                    <p class="mb-0">&#9733; {{ place.average_rating }}</p>
                                {% else %}
                                    <p class="mb-0 text-muted">No ratings yet</p>
                                {% endif %}
                            </div>

                            {% if place.images.all %}
                                <div class="place-card-images">
                                    {% for image in place.images.all|slice:":3" %}
                                        <img src="{{ image.image.url }}" alt="Photo of {{ place.name }}">
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        </section>
    {% else %}
        <p class="text-muted">You haven't liked any places yet.</p>
    {% endif %}
</section>
{% endif %}

{% endblock %}
